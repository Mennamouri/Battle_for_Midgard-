/*
** jeu.c for  in /home/maryem/Piscine/Projet_Final_C/my_FTL
** 
** Made by ENNAMOURI Maryem
** Login   <ennamo_m@etna-alternance.net>
** 
** Started on  Thu Nov 10 17:53:15 2016 ENNAMOURI Maryem
** Last update Fri Nov 11 22:37:41 2016 ENNAMOURI Maryem
*/

#include "ftl.h"
#include <stdlib.h>
#include <time.h>

void			my_putstr_color(const char *color, const char *str);
t_ship *create_ship();
int	add_weapon_to_ship(t_ship *ship);
int	add_ftl_drive_to_ship(t_ship *ship);
int	add_navigation_tools_to_ship(t_ship *ship);
int	add_container_to_ship(t_ship *ship);
int	system_repair(t_ship *ship);
int	my_strcmp(char *s1, char *s2);
void	*readline(void);
void	my_putstr(char *str);
void	my_putchar(char c);
void	my_put_nbr(int nb);
int	detect_game(t_ship *ship);
void	get_bonus(t_ship *the_ship);
void	add_freight_to_container(t_ship *ship, t_freight *the_freight);
char	*my_strdup(char *str);

void	my_ftl_draw()
{
  my_putchar('\n');
  my_putchar('\n');
  my_putstr_color("red",     "                              ************************************************************\n");
  my_putstr_color("cyan",    "                                             ***************************                  \n");
  my_putstr_color("yellow",  "                                             ***************************                  \n");
  my_putstr_color("red",     "                              ************************************************************\n\n");
  my_putstr_color("cyan",    "                             '##    '## '##   '##           '######## '######## '##       \n");
  my_putstr_color("yellow",  "                              ###  '###   ## '## ::::::::::: ##           ##     ##       \n");
  my_putstr_color("magenta", "                              ####'####    ####  ::::::::::: ##           ##     ##       \n");
  my_putstr_color("cyan",    "                              ## ### ##     ##   ::::::::::: ######       ##     ##       \n");
  my_putstr_color("yellow",  "                              ##  #  ##     ##   ::::::::::: ##           ##     ##       \n");
  my_putstr_color("magenta", "                              ##     ##     ##   ::::::::::: ##           ##     ##       \n");
  my_putstr_color("cyan",    "                              ##     ##     ##   ::#######:: ##           ##     ######## \n\n");
  my_putstr_color("red",     "                              ************************************************************\n");
  my_putstr_color("yellow",  "                                             ***************************                  \n");
  my_putstr_color("cyan",    "                                             ***************************                  \n");
  my_putstr_color("red",     "                              ************************************************************\n\n");
}

void	help_game()
{
  my_putstr_color("green", "############### **MENU_HELP** #####################\n");
  my_putstr_color("red","attack\n");
  my_putstr_color("red","detect\n");
  my_putstr_color("red","getbonus\n");
  my_putstr_color("red","jump\n");
  my_putstr_color("red","stat\n");
  my_putstr_color("red","help\n");
  my_putstr_color("green", "############### ************** #####################\n");
}

void	stat_game(t_ship *the_ship)
{
  my_putstr_color("yellow", "############### **STAT_GAME** #####################\n");
  my_putstr_color("magenta","Hull : ");
  my_put_nbr(the_ship->hull);
  my_putchar('\n');
  my_putstr_color("magenta","Sector : ");
  my_put_nbr(the_ship->my_navigation->sector);
  my_putchar('\n');
  my_putstr_color("magenta","Evade : ");
  my_put_nbr(the_ship->my_navigation->evade);
  my_putchar('\n');
  my_putstr_color("magenta","Damage : ");
  my_put_nbr(the_ship->my_weapon->damage);
  my_putchar('\n');
  my_putstr_color("magenta","Energy : ");
  my_put_nbr(the_ship->my_drive->energy);
  my_putchar('\n');
  my_putstr_color("yellow", "############### ************** #####################\n");
}

void	jump_game(t_ship *the_ship)
{
  the_ship->my_navigation->sector++;
  the_ship->my_drive->energy--;
}

int	game()
{
  t_ship *ship;
  char	*str;
  my_ftl_draw();
  ship = create_ship();
  add_weapon_to_ship(ship);
  add_ftl_drive_to_ship(ship);
  add_navigation_tools_to_ship(ship);
  add_container_to_ship(ship);
  my_putstr_color("cyan", "waiting_for_orders\n");
  //system_repair(ship);
  while ((ship->my_navigation->sector < 10) || (ship->my_drive->energy > 0 && ship->my_navigation->sector < 10) || (ship->hull > 0))
  {
    my_putstr_color("cyan", "quelle est votre action :) ?\n");
    str = readline();
    if (my_strcmp(str, "attack") != 0 && my_strcmp(str, "detect") != 0 && my_strcmp(str, "jump") != 0 && my_strcmp(str, "getbonus") != 0 && my_strcmp(str, "stat") && my_strcmp(str, "help"))
      my_putstr_color("red", "erreur argument! faites help pour en savoir plus :D !! \n");
    if (my_strcmp(str, "detect") == 0)
    detect_game(ship);
    if (my_strcmp(str, "getbonus") == 0)
      get_bonus(ship);
    if (my_strcmp(str, "jump") == 0)
      jump_game(ship);
    if (my_strcmp(str, "stat") == 0)
        stat_game(ship);
    if (my_strcmp(str, "help") == 0)
        help_game();
  }
  return (0);
}

int	detect_game(t_ship *ship)
{
  t_freight	*the_freight;
  int	i;

  i= 0;
  srand (time(NULL));
  while (i < 10)
  {
    the_freight = malloc(sizeof(*the_freight));
    if (rand() % 100 < 69)
    {
      the_freight->item = my_strdup("scrap");
    }
    else
    {
      if (rand() % 100 > 69 && rand() % 100 < 78)
      {
	the_freight->item = my_strdup("energy");
      }
      else if (rand() % 100 > 78 && rand() % 100 < 88)
      {
	the_freight->item = my_strdup("attackbonus");
      }
      else if (rand() % 100 >88 && rand() % 100 < 98)
      {
	the_freight->item = my_strdup("evadebonus");
      }
      else
      {
	the_freight->item = my_strdup("scrap");
      }
    }
    the_freight->prev = NULL;
    the_freight->next = NULL;
    add_freight_to_container(ship, the_freight);
    i++;
  }
  return (0);
}
